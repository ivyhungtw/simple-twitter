(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-34b1d67e"],{"14b9":function(e,s,t){e.exports=t.p+"img/conversation.873c4926.svg"},"3bae":function(e,s,t){"use strict";var a=t("2fa3");s["a"]={getPublicRoom:function(){return a["b"].get("/rooms/4")},createPrivateRoom:function(e){return a["b"].post("/rooms",{userId:e})},getPrivateRoom:function(e){return a["b"].get("/rooms/".concat(e))},getNotification:function(){return a["b"].get("/rooms/notifications")},getRoom:function(e){return a["b"].get("/rooms/".concat(e))},getRoomsByUser:function(){return a["b"].get("/rooms")},getAvailableUsers:function(){return a["b"].get("rooms/availableUsers")},getUnread:function(){return a["b"].get("/private/unread")}}},4262:function(e,s,t){},"521f":function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{staticClass:"messageBox"},[e.atPublic?[a("div",{staticClass:"title",on:{click:e.updateScroll}},[a("h1",[e._v("公開聊天室")])])]:[e.currentChat.name?a("div",{staticClass:"title private"},[a("h1",[e._v(e._s(e.currentChat.name?e.currentChat.name:"UserName"))]),a("p",[e._v("@"+e._s(e.currentChat.account?e.currentChat.account:"UserAccount"))])]):a("div",{staticClass:"title noChat"},[a("h1",[e._v("開啟聊天！")])])],a("div",{ref:"messageList",staticClass:"container"},[a("ul",{staticClass:"messageList"},[e.isProcessing?a("Spinner"):[e.messageList.length?e._l(e.messageList,(function(s){return[0===s.type?a("li",{key:s.id,staticClass:"actionItem"},[a("p",[e._v(e._s(s.text))])]):a("li",{key:s.id,staticClass:"messageItem",class:{currentUser:s.UserId===e.currentUser.id}},[a("div",{staticClass:"mainContent"},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:e._f("emptyImageFilter")(s.avatar),alt:""}})]),a("div",{staticClass:"textContainer"},[a("div",{staticClass:"text"},[e._v(" "+e._s(s.message)+" ")])])]),a("div",{staticClass:"textTime"},[e._v(e._s(e._f("fromNow")(s.createdAt)))])])]})):a("div",{staticClass:"emptyList"},[a("img",{attrs:{src:t("14b9"),alt:""}})])]],2)]),a("div",{staticClass:"meesagePanel"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],attrs:{id:"textInput",placeholder:"輸入訊息...",type:"text",maxlength:"160",required:"",disabled:void 0===e.currentChat.userId},domProps:{value:e.message},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMessage(s)},input:function(s){s.target.composing||(e.message=s.target.value)}}}),a("button",{staticClass:"btn sendBtn",attrs:{disabled:void 0===e.currentChat.userId,type:"submit"},on:{click:e.sendMessage}},[a("img",{attrs:{src:t("ad0d"),alt:""}})])])],2)},n=[],i=t("5530"),r=t("2375"),o=t("2708"),c=t("2fa3"),u=t("2f62"),l={name:"MessageBox",mixins:[o["a"],o["c"]],components:{Spinner:r["a"]},props:{currentChat:{type:Object,default:function(){return{userId:void 0,name:"",account:""}}},messageList:{type:Array,required:!0},atPublic:{type:Boolean,default:!1}},data:function(){return{message:"",isProcessing:!1}},updated:function(){console.log("updated"),this.updateScroll()},methods:{sendMessage:function(){var e=this,s=this.message;if(this.message){var t=!this.messageList.length;console.log("atPublic: "+this.atPublic),this.atPublic?this.$socket.emit("chat message",{roomId:this.currentRoomId,userId:this.currentUser.id,newMessage:t,message:s},(function(){console.log("currentRoomId: "+e.currentRoomId),console.log("private chat message, new: ".concat(t))})):this.$socket.emit("private chat message",{roomId:this.currentRoomId,userId:this.currentUser.id,newMessage:t,message:s},(function(){console.log("currentRoomId: "+e.currentRoomId),console.log("private chat message, new: ".concat(t))})),this.message="",c["a"].fire({icon:"success",title:"訊息已發送!"})}else c["a"].fire({icon:"error",title:"尚未輸入訊息!"})},toggleIsProcessing:function(){this.isProcessing=!this.isProcessing},updateScroll:function(){this.$refs.messageList.scrollTop=this.$refs.messageList.scrollHeight}},computed:Object(i["a"])({},Object(u["b"])(["currentUser","currentRoomId"]))},m=l,g=(t("ef80"),t("2877")),d=Object(g["a"])(m,a,n,!1,null,"435f38ae",null);s["a"]=d.exports},ad0d:function(e,s,t){e.exports=t.p+"img/send.376b4246.svg"},d3b0:function(e,s,t){},d8c3:function(e,s,t){"use strict";t("4262")},ef80:function(e,s,t){"use strict";t("d3b0")},ffce:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"publicMessage"},[t("UserSidebar"),t("div",{staticClass:"mainSection"},[t("div",{staticClass:"usersOnline"},[t("div",{staticClass:"title"},[t("h1",[e._v("上線使用者 ("+e._s(e.onlineUsersCount)+")")])]),t("div",{staticClass:"container"},[t("ul",{staticClass:"userList"},[e.isProcessing?t("Spinner"):e._e(),e._l(e.onlineUsers,(function(s){return t("li",{key:s.id,staticClass:"userItem"},[t("div",{staticClass:"userContainer"},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:e._f("emptyImageFilter")(s.avatar),alt:""}})]),t("div",{staticClass:"userName"},[t("p",[e._v(e._s(s.name))])]),t("div",{staticClass:"userAccount"},[t("p",[e._v("@"+e._s(s.account))])])])])}))],2)])]),t("MessageBox",{ref:"messageBox",attrs:{currentChat:e.currentChat,atPublic:e.atPublic,messageList:e.messageList}})],1)],1)},n=[],i=t("5530"),r=t("1da1"),o=(t("b0c0"),t("96cf"),t("a004")),c=t("521f"),u=t("2375"),l=t("2708"),m=t("2fa3"),g=t("2f62"),d=t("3bae"),f={name:"publicMessage",components:{UserSidebar:o["a"],MessageBox:c["a"],Spinner:u["a"]},mixins:[l["a"],l["c"]],data:function(){return{currentChat:{userId:"publicRoom",name:"公開聊天室",account:""},message:"",messageList:[],onlineUsersCount:1,onlineUsers:[],atPublic:!0,isProcessing:!0}},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var t,a,n,i,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e.$socket.emit("leave"),e.$store.commit("setCurrentRoomId",4),s.prev=2,e.isProcessing=!0,e.$refs.messageBox.toggleIsProcessing(),s.next=7,d["a"].getPublicRoom();case 7:t=s.sent,a=t.data,n=a.messages,i=a.onlineUsersCount,r=a.onlineUsers,e.messageList=n,e.onlineUsers=r,e.onlineUsersCount=i,e.$refs.messageBox.toggleIsProcessing(),e.joinPublicRoom(),s.next=22;break;case 17:s.prev=17,s.t0=s["catch"](2),e.isProcessing=!1,console.log(s.t0),m["a"].fire({icon:"error",title:s.t0});case 22:case"end":return s.stop()}}),s,null,[[2,17]])})))()},sockets:{"chat message":function(e){console.log("Got message: "+e.text),this.messageList.push({id:this.messageList+1,UserId:e.userId,type:1,avatar:e.avatar,message:e.text,createdAt:new Date})},"users count":function(e){var s=e.users,t=e.userCount;this.onlineUsers=s,this.onlineUsersCount=t},message:function(e){this.messageList.push({id:this.messageList.length+1,type:0,text:e.text}),this.message=""}},methods:{joinPublicRoom:function(){this.$socket.emit("join",{username:this.currentUser.name,roomId:4,userId:this.currentUser.id}),this.isProcessing=!1}},computed:Object(i["a"])({},Object(g["b"])(["currentUser","currentRoomId"]))},v=f,h=(t("d8c3"),t("2877")),p=Object(h["a"])(v,a,n,!1,null,"5b13d8e7",null);s["default"]=p.exports}}]);
//# sourceMappingURL=chunk-34b1d67e.4d50d8b3.js.map